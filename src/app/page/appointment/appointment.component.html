<app-navbar></app-navbar>
<div class="flex flex-column align-items-stretch">
  <div>
    <p-button
      class="button-add-user"
      label="เพิ่มผู้ใช้"
      [rounded]="true"
      severity="info"
      (onClick)="showDialogAddUser()"
      *ngIf="userRole === 1"
    />
    <p-button
      class="button-add-appointment"
      label="เพิ่มสัตว์เลี้ยง"
      [rounded]="true"
      severity="info"
      (onClick)="showDialogAddPet()"
      *ngIf="userRole === 1"
    />
    <p-button
    class="button-add-user"
    label="เพิ่มประเภทบริการ"
    [rounded]="true"
    severity="info"
    (onClick)="showDialogAddSubject()"
    *ngIf="userRole === 1"
  />
    <p-button
      class="button-add-appointment"
      label="เพิ่มนัดหมายสัตว์เลี้ยง"
      [rounded]="true"
      severity="info"
      (onClick)="showDialogAddAppoinment()"
      *ngIf="userRole != 1"
    />
  </div>

  <div class="main-table">
    <p-table [value]="data" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th>ชื่อ</th>
          <th>หัวข้อ</th>
          <th>ประเภทสัตว์เลี้ยง</th>
          <th>พันธุ์สัตว์เลี้ยง</th>
          <th>ชื่อสัตว์เลี้ยง</th>
          <th>เวลาการจอง</th>
          <th>สถานะ</th>
          <th>จัดการ</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-appointment>
        <tr>
          <td>{{ appointment.name }}</td>
          <td>{{ appointment.subject }}</td>
          <td>{{ appointment.animals_type }}</td>
          <td>{{ appointment.animals_breed }}</td>
          <td>{{ appointment.animals_name }}</td>
          <td>{{ appointment.time }}</td>
          <td>{{ appointment.status }}</td>
          <td>
            <i
              class="pi pi-pen-to-square m-2"
              style="font-size: 1.5rem; color: rgb(43, 169, 247)"
            ></i>
            <i
              class="pi pi-trash m-2"
              style="font-size: 1.5rem; color: rgb(226, 48, 48)"
            ></i>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <div class="card flex justify-content-center">
    <p-dialog
      header="เพิ่มผู้ใช้"
      [modal]="true"
      [(visible)]="addUser"
      [style]="{ width: '25rem' }"
    >
      <form [formGroup]="userForm" (ngSubmit)="saveUser()">
        <span class="p-text-secondary block mb-5">เพิ่มผู้ใช้</span>

        <div class="flex align-items-center gap-3 mb-3">
          <label for="username" class="font-semibold w-6rem">ผู้ใช้</label>
          <input
            pInputText
            id="username"
            class="flex-auto"
            formControlName="username"
            autocomplete="off"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="password" class="font-semibold w-6rem">รหัสผ่าน</label>
          <input
            pInputText
            id="password"
            class="flex-auto"
            formControlName="password"
            autocomplete="off"
            type="password"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="firstname" class="font-semibold w-6rem">ชื่อจริง</label>
          <input
            pInputText
            id="firstname"
            class="flex-auto"
            formControlName="firstname"
            autocomplete="off"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="lastname" class="font-semibold w-6rem">นามสกุล</label>
          <input
            pInputText
            id="lastname"
            class="flex-auto"
            formControlName="lastname"
            autocomplete="off"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="phone" class="font-semibold w-6rem">เบอร์โทรศัพท์</label>
          <input
            pInputText
            id="phone"
            class="flex-auto"
            formControlName="phone"
            autocomplete="off"
            required
          />
          <div
            *ngIf="
              userForm.controls['phone'].invalid &&
              userForm.controls['phone'].touched
            "
            class="text-danger"
          >
            กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง
          </div>
        </div>

        <div class="flex justify-content-end gap-2">
          <p-button
            label="Cancel"
            severity="secondary"
            (onClick)="closeAddUser()"
          ></p-button>
          <p-button label="Save" type="submit"></p-button>
        </div>
      </form>
    </p-dialog>
  </div>

  <div class="card flex justify-content-center">
    <p-dialog
      header="เพิ่มการจอง"
      [modal]="true"
      [(visible)]="addAppoinment"
      [style]="{ width: '50rem', height: '120rem' }"
    >
      <form [formGroup]="appointmentForm">
        <!-- <span class="p-text-secondary block mb-5">เพิ่มการจอง</span> -->

        <div class="flex align-items-center gap-3 mb-5">
          <label for="email" class="font-semibold w-6rem">สัตว์เลี้ยง</label>
          <div class="card flex justify-content-center">
            <p-dropdown
              [options]="pets"
              formControlName="selectedPet"
              optionLabel="name"
              placeholder="Select"
            />
          </div>
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="email" class="font-semibold w-6rem">น้ำหนัก</label>
          <input
            pInputText
            id="email"
            class="flex-auto"
            autocomplete="off"
            formControlName="weight"
            [value]="weight[0]?.weight"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="email" class="font-semibold w-6rem">หัวข้อ</label>
          <div class="card flex justify-content-center">
            <p-dropdown
              [options]="filteredSubjects"
              formControlName="selectedSubject"
              optionLabel="subject"
              placeholder="Select"
            />
          </div>
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="email" class="font-semibold w-6rem">ราคา</label>
          <input
            pInputText
            id="price"
            class="flex-auto"
            autocomplete="off"
            [value]="priceValue ?? ''"
            readonly
          />
        </div>
        <div class="flex align-items-center gap-3 mb-5">
          <label for="appointmentDate" class="font-semibold w-6rem"
            >วันที่</label
          >
          <p-calendar
            formControlName="selectedDate"
            [(ngModel)]="selectedDate"
            [showIcon]="true"
            [showOnFocus]="false"
            inputId="buttondisplay"
            [ngModelOptions]="{ standalone: true }"
            (onSelect)="onDateSelected($event)"
          />
        </div>
        <div class="flex align-items-center gap-3 mb-5">
          <label class="font-semibold w-6rem">เวลา</label>
          <p-dropdown
            [options]="petsByUser"
            optionLabel="time"
            placeholder="เลือกเวลาที่ว่าง"
            formControlName="selectedTimeSlot"
          />
        </div>
        <div class="flex justify-content-end gap-2">
          <p-button
            label="Cancel"
            severity="secondary"
            (onClick)="closeAddAppoinment()"
          />
          <p-button label="Save" (onClick)="saveAppoinment()" />
        </div>
      </form>
    </p-dialog>
  </div>

  <div class="card flex justify-content-center">
    <p-dialog
      header="เพิ่มสัตว์เลี้ยง"
      [modal]="true"
      [(visible)]="addPet"
      [style]="{ width: '25rem' }"
    >
      <form [formGroup]="petForm">
        <div class="flex align-items-center gap-3 mb-5">
          <label for="name" class="font-semibold w-6rem">ชื่อผู้ใช้</label>
          <div class="card flex justify-content-center">
            <p-multiSelect
              [options]="users"
              formControlName="userId"
              variant="filled"
              optionLabel="name"
              placeholder="กรุณาเลือกผู้ใช้"
            />
          </div>
        </div>
        <div class="flex align-items-center gap-3 mb-5">
          <label for="name" class="font-semibold w-6rem">ชื่อ</label>
          <input
            pInputText
            id="name"
            class="flex-auto"
            formControlName="name"
            autocomplete="off"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label class="font-semibold w-6rem">ประเภทสัตว์เลี้ยง</label>
          <p-dropdown
            [options]="animalsTypes"
            [(ngModel)]="selectedAnimalsTypes"
            optionLabel="name"
            formControlName="type"
            placeholder="เลือกประเภทสัตว์เลี้ยง"
            (onChange)="onAnimalTypeChange()"
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="breed" class="font-semibold w-6rem">สายพันธุ์</label>
          <input
            pInputText
            id="breed"
            class="flex-auto"
            formControlName="breed"
            autocomplete="off"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label for="age" class="font-semibold w-6rem">อายุ</label>
          <input
            pInputText
            id="age"
            class="flex-auto"
            formControlName="age"
            autocomplete="off"
            required
          />
        </div>

        <div class="flex align-items-center gap-3 mb-5">
          <label class="font-semibold w-6rem">น้ำหนัก</label>
          <p-dropdown
            [options]="allWeight"
            [(ngModel)]="selectedWeight"
            formControlName="weight"
            optionLabel="weight"
            placeholder="เลือกน้ำหนัก"
          />
        </div>

        <div class="flex justify-content-end gap-2">
          <p-button
            label="Cancel"
            severity="secondary"
            (onClick)="closeAddPet()"
          />
          <p-button
            label="Save"
            (onClick)="savePet()"
            [disabled]="petForm.invalid"
          />
        </div>
      </form>
    </p-dialog>
  </div>

  <div class="card flex justify-content-center">
    <p-dialog
      header="จัดการประเภทบริการ"
      [modal]="true"
      [(visible)]="addSubject"
      [style]="{ width: '25rem' }"
    >
      <form [formGroup]="subjectForm" (ngSubmit)="saveSubjct()">
        <div class="flex align-items-center gap-3 mb-3">
          <label for="username" class="font-semibold w-6rem">ประเภทบริการ</label>
          <input
            pInputText
            id="subject"
            class="flex-auto"
            formControlName="subject"
            autocomplete="off"
            required
          />
        </div>

        <div class="flex justify-content-end gap-2">
          <p-button
            label="Cancel"
            severity="secondary"
            (onClick)="closeAddSubject()"
          ></p-button>
          <p-button label="Save" type="submit"></p-button>
        </div>
      </form>
    </p-dialog>
  </div>
</div>
